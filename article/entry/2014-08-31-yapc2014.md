tags: conference
---
# YAPC::ASIA 2014 感想

大日上野大会で「窒息寸前水地獄!!!緊張の夏!!!大日本の夏!!!」「あなたの知らないサマーバケーションレスリング!!!」「ポセイドンアドベンチャースプラッシュマッチ　in上野」でロビン対アトランティスの名勝負が再現され、HEAT-UP三連戦では物販のくじでキープオンジャーニーが供され、ハレタコーガン20周年記念興行でGENTAROのプロレス教室が突如開催される中、それらの全てを蹴ってYAPC::ASIA 2014に3日間参戦しました。感想です。

## インフラエンジニア(狭義)は死んだ 

- コードの読み書きができるべきとかそんなのの裏にある話

### 感想

- コードを読み書きできないと、問題解決に寄与できる部分がずいぶん減るという話だと思った。
- そうな。という話ではあるんだけど、問題解決のためという目的は意識の外に出がちではある。

### メモ

- Operation Engineer's Casual Talk
    - tagomorisさんのトーク
        - ほげエンジニアの定義
        - 分業は不可、最初は全部一人で
    - パネルディスカッション
        - コードは問題解決の手段のひとつ

## 完成されたシステムなどない。完成された人間もいない。あるのは成長し続ける未完成なシステムと、それを支える未完成な人間だけだ

- 変化するシステムを運用していく話
- 壊れないシステムなど無く、ミスをしない人間などいない
- その前提で、サービスの運用で大切な要素: 記録, 保険, 再現性, シンプルさ

### 感想

- 大変スペーシーなセッションでした
- 当たり前の話ではあるんだけど、懇親会でそうなってないシステムを運用している話を聞いて、この話大事ですねーと話してた
- どうしようか迷った時に立ち返る基本
- そのへんの思想については『UNIXという考え方』に。大事そうなのでポチりました

### メモ

- 故障、ミスの対策: 記録と保険
- scale out時に必要なこと
    - 再現性
        - いつでも同じものがどこでも作れる
            - 特定のPaaSでしか動かないのはNG
    - シンプルさ
- 機能追加, 複雑性が増す
    - 必要なことは同じ。再現性とシンプルさ。
        - →変化に強いシステムになる
- 対策と問題解決は天秤
    - 対策に時間をかけると問題解決は早くなる
    - 対策に時間をかけないと問題解決に時間がかかる
    - 時間は有限
    - コストとリスクで決定
        - リスクの考え方
            - サービスが許容できるダウンタイムは？
- 日本語版『UNIXの考え方』から学ぶ
- どうせ壊れるなら、壊れやすいように作っておこう: Imutable Infra...
- すでにあるダメなシステム
    - NG: 問題を見つけてはつぶす
    - OK: 全体を把握するところからはじめる

## 最近のウェブサービスの検索機能やその先の話 

- 検索の話。ElasticSearchがメイン

### 感想

- サービスで検索を提供するというのがあまりイメージなかったので、その辺の話が聞けたのが良かった
- 以前はスケールさせるのが難しいという事だったけど、今どうスケールさせるのか聞きそびれた
- クラスタを2セット用意して、リインデックスはスタンバイ系でやって追いついたら切り替えるという運用の話が参考になった

### メモ

- Presso(ニュースキュレーション的なサービス？)で適切なニュースを出すために、複雑な検索クエリが必要
- 文章構造、文章間の親子関係が持てる(ElasticSearchの中でその構造を利用した検索ができると言うこと？)
- ある検索クエリーがあったとして、それを別な検索クエリーの1条件としてネストしたところに書ける
- 集約系(Aggregation API)が強化されそう
- マッピングで文章の構造を作る
    - 構造が変わったらリインデックスする
    - サービスを止めずにリインデックスするには
        - おなじクラスタをもうひとつ用意して、そちらでリインデックス、終わったら切り替える

## 作られては消えていく、泡のように儚いクラスタの運用話

- TVの企画で構築しては消していくインフラの話
- AWS

### 感想

- リアルタイムに増減設するのかと思ってたけど、負荷は想定しやすいそうでその辺の話はなかった
- 本番一発勝負ほんとに怖そう
    - 本番をまるごと再現するようなテストがちょう大切
    - 24H/365Dのシステムでもできればやりたいけど、実施コストとか本番稼働後の対応でもいいみたいなスピード感で、エイヤでやる範囲が広いのだろうな、とか
- chefとvagrant-awsをつかったインフラデプロイフローはよさそう

## コマンドラインツールについて語るときに僕の語ること

- CLIツールを作るお作法
- 配布の仕方

### 感想

- お作法的な部分が大変勉強になった
    - こういうの、社内で口伝される以外で聞いたことないので本当にありがたい
    - こういうのどこで勉強したんだろう
- これに沿って作れは技術的負債を残すリスクが相当下がりそう
- ここでも『UNIXという考え方』出てきた
    - やっぱり大事っぽい
    - ツールを作る単位: 説明をシンプルに一文で書けるか
- ベストトーク投票した

### メモ

- コマンドの構成
- デフォルトでは快適な操作はさせない, --forceオプションをつける
- 対話インタフェースは避ける

## DeNAが歩んだデプロイ自動化への道

### 感想

- リリースの簡易正が安全性の指標になるという考え方はなかったので目鱗
    - デプロイを何回もやることがデプロイ自体の信頼性を高めるの、言われてみればたしかにそう
- コードが何もない状態から自動デプロイ環境を作るゼロデプロイ大変良さそう

### メモ

- 安全工学
- リリースが困難かどうか: 安全性の指標になる
- 開発,検証,本番環境で同じ方法でデプロイできること
    - できないとデプロイの検証にならない
- Jenkinsで一連のデプロイプロセスをジョブ化
- 本番リリースも信頼された反復プロセスに過ぎない
- ゼロデプロイ
- CDが現実的でないテストケースもある
    - そのあたりは泥臭く(人手で？)やってる

## MySQLのWHERE狙いのキーとORDER BY狙いのキーの話

- テーブルスキャンやファイルソートがなぜ遅いのかとか、そこにインデックスがどう効いてくるのか
- MySQLの動作をPerlのコードで表現して説明

### 感想

- めっちゃわかった
- JOINのあたりはちゃんとわかってない
    - 外部表とか。MySQL力というかSQL力が足りない

### メモ

- インデックスとはソート済みのデータの複製
    - ORDER BYで取り出すときにソートしなくていいから速い
- JOINでORDER BYにインデックスを効かせたければ、そのカラムが外部表にある必要がある

## ウェッブエンジニアのローレベルプログラミング

- アセンブリでwebサーバ
- Raspberry PiでI2CデバイスにOSからアクセス
- AVR(というワンチップマイコン)にプログラムを書きこんで動かす
    - USBデバイスを自作

### 感想

- めっちゃ楽しそうだった(cho45さんが)
- どうでもいい話ですが、cho45さんがスライドに近づいて音声入りにくくなった時、スタッフのnekogerugeさんがハンドマイクを渡そうと近くに持ってって観衆皆気づいてるけどcho45さんだけ気づかずじわじわ笑いが起こるという事があって、それいらいcho45さんがスライドに近づいてマイクの音が小さくなる度に面白くて仕方がなかった。
- ベストトーク投票した

### メモ

- ARM/Linuxでアセンブリを書くのがオススメ
- Linux ABI を理解する必要がある
 
## 開発合宿!!!!

- 開発合宿の運営について

### 感想

- やりたくなった。
- 参加できる人、できない人は運用でカバーできてるんだったら弊社でもいけるのでは
- 仕事でがっつりチーム開発してるわけではないので、開発フローを事前にすり合わせるみたいな準備が必要そう

## 突然ITインフラを任された人のための…監視設計入門

- 監視するところのレイヤーの話
- 監視項目の洗い出し方, 閾値の決め方
- 監視体制

### 感想

- 弊社koemuさんのトークでした
- 弊社の監視ノウハウが凝縮されたトークでした
- 弊社入社すぐの社内教育にめっちゃよさそう
- koemu劇場よい
    - トーク開始前に漫談
    - QAで自ら質問を求めマイクを向ける
- ベストトーク投票した

## Perl Mongersのためのstrace入門

- システムコールの基本
- fdの置い方
- straceの見方の実例
    - HTTPサーバ
    - MySQL, Memcached

### 感想

- 大変よい入門になった
- 確実にシステムの動作を追う方法は知っておいたほうがよい
    - 前にシステムで原因不明の不具合があって、どのレイヤーで問題出てるかもわからなくて、straceから切り分けたことがあった(気がする)
    - できることとか、ざっくりした見方とか、そういうのを抑えてるといざという時にできることが広がってよい
- ベストトーク投票した

### メモ

- システムコール
- APIがリクエストを受けてレスポンスを返す流れ
    - accept, read, hogehoge(ここでいろんな処理), write
- strace plackup hoge.psgi
    - straceコマンド経由で、起動して
- webサーバ: acceptで止まる = リクエストを待ち受けてる状態
    - ブロッキング: システムコールを呼んで、その結果を待っている状態
- fd:ファイルディスクリプタ: 0,1,2は決まってる、あとは連番で割り当てられる
    - openしたらfbが返ってくる
- fdを追う
    - openからcloseまで
    - acceptで返ってくる〜close: アクセスを受けてレスポンスを返すまで
- demo
    - acceptの戻り値: 5
    - readでURLを呼んでる
    - writeで5に200を返す
    - 5をcloseしておわり(keepaliveをしてないから)
- ポート番号とかで捜査して、特定のアプリのシステムコールを探す
- mysqlはソケットファイル名とかが出てる
- プログラムが思ったとおりに動いてるかどうかを確認するためにつかえる
    - connection何回も張ってる
    - おなじクエリを何回も実行してる
- -e "trace-sendmsg": 特定のシステムコールに絞って出す
- EAGAIN

## Perl For (Non?) Perl Mongers

- Perl大好き！

### 感想

- 小さいモジュールを組み合わせて作る文化
    - ここでも『UNIXという考え方』
    - CPANはほんと良いし、よいモジュールの情報がちゃんと出るのもPerlのいいところな気がした
        - 他は知らん
- よくわからないところもあって、Perl力というよりプログラミング力の低さを感じた
    - オブジェクト指向の理解できてなさ

## OAuth/OpenID Connectを用いてID連携を実装するときに気を付けること

- 内容はタイトル通り

### 感想

- ソーシャルログインで何を代替するのか、という視点が大事そうだった
    - ID認証
    - メールの確認
- セキュリティに配慮して作らないと死ぬことはわかった

### メモ

- OAuth 2.0で使われてる仕組み(OAuth Dance), Twitter以外
- 連携キャンセル時にどう動かすか
- Janrain.com ソーシャルログイン用SaaS
- ソーシャルログインで何を代替するのか
    - ID認証
    - メールの確認
    - ...

## そんなにビッグでもないデータ処理手法の話

- データ処理のためのミドルウェア紹介的な
- どう選定するのかという話も

### 感想

- めっちゃ速い
- どのミドルも触った事ないのであんまりイメージが沸かず
- MapReduce試してみたい


### メモ

- 集める > parse > process > visualize
- processの話
- どんなデータを扱うのかを考える
    - サイズ
    - 構造
- 正確なデータ量は考えるな、どうせ上下する
- 一回あたりの計算が扱うデータの量を考える
- 今日は1GB〜数100TBまでを扱う
- 大体のwebサービスの裏側で蓄積されるデータ量
    - 1monthで考えると結構な容量になる
- メモリに載せるには大きい、載せ方を考えないとならない
- データのいろんな使い方がある、そこから何をやりたいのか
    - →計算処理の特性を決める
- なにをやるかでどこがネックになるかが決まる
    - 検索, 集計 : I/O
    - 機会学習, グラフ化 : CPU
    - それにあわせてフレームワークを選択
- いろんなミドルを見ていく
    - MapReduce: 今はこれがstable、他は作られたばかりで枯れてない
    - Apache Spark: オンメモリ特化, 機会学習、グラフ化に向いてる
- Stream processing : 流れてきたところから処理する
    - Twitter Storm, Norikra///
- JVMに支配された世界
- 自分たちの環境と結合してやる必要がある
    - Perlでやればいいんじゃ？
- スローログ解析とか？試してみたい

## 全体的に

- Golangいろんな所で見た。流行ってる。
- 一方で『UNIXという考え方』もいろんな所で出てた。思想。

## ソーシャル

- 大学の同じゼミだった人が登壇しててびっくりした
    - 相変わらずチェックのパンツ履いてた
- 懇親会で初対面の方のお辛い話を色々聞いた
    - FAX対応なくならないとか
    - salesforceよく落ちるとか
- HUBには行かなかった
    - それくらいの参加具合がそんなにソーシャル疲れしなくてよさそう
- プリパラが今一番キてる
    - ディスクウォーズ・アベンジャーズも熱い

## Tシャツ

- 前夜祭nginx: 「それはnginx公式？ユーザー会公式？」と聞かれたがそんなことは知らん
- 一日目DEFCON: 懇親会で来ててもまったくひっかからず
- 二日目関本大介: 背中にサイン入ってるのにまったくひっかからず
- 反省: papixさんの自己愛Tの前では全てが霞む


- 
